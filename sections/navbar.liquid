{% assign main_menu_link_list = linklists[section.settings.another_menu].links %}

<div class="bg-green-100">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 flex items-center justify-between py-4">
    <!-- Logo / Title -->
    <h1 class="text-xl font-bold">{{ section.settings.header_Title }}</h1>

    <!-- Desktop Navigation with Dropdown -->
    <nav class="hidden md:flex space-x-6">
      {% for link in main_menu_link_list %}
        {% if link.links != blank %}
          <!-- Has Dropdown -->
          <!-- Has Dropdown -->
          <!-- Trigger Button -->
          <div class="relative">
            <button
              id="dropdown-toggle"
              class="text-green-600 hover:text-green-950 text-base font-medium flex items-center"
            >
              {{ link.title }}
              <svg
                class="ml-1 w-4 h-4"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
          </div>

          <!-- Dropdown Menu at the end of body (you can use {% render 'menu-dropdown' %}) -->
          <div
            id="dropdown-menu"
            class="fixed left-1/2 top-[90px] -translate-x-1/2 w-[98vw] bg-green-50 shadow-2xl shadow-green-200 rounded-b-3xl z-50 opacity-0 scale-95 invisible transition-all duration-300 "
          >
            <div class="px-4 py-4">
              <ul class="flex flex-wrap justify-between items-center gap-4 text-center">
                {% for child in link.links %}
                  <li class="w-fit mx-auto text-center">
                    <a
                      href="{{ child.url }}"
                      class="block px-4 py-2 text-green-800 hover:bg-green-200 hover:text-green-950 rounded-md"
                    >
                      {{ child.title }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </div>
          </div>

        {% else %}
          <!-- No Dropdown -->
          <a href="{{ link.url }}" class="text-green-600 hover:text-green-950 text-base font-medium">
            {{ link.title }}
          </a>
        {% endif %}
      {% endfor %}
    </nav>

    <!-- Cart + Login -->
    <div class="hidden md:flex items-center space-x-4">
      <a href="{{ routes.cart_url }}" class="text-green-600 hover:text-green-950">Cart</a>

      {% if shop.customer_accounts_enabled %}
        <a href="{{ routes.account_login_url }}" class="text-green-600 hover:text-green-950">Login</a>
        <a href="{{ routes.account_register_url }}" class="text-green-600 hover:text-green-950">Register</a>
      {% endif %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleBtn = document.getElementById('dropdown-toggle');
    const menu = document.getElementById('dropdown-menu');

    let isOpen = false;

    toggleBtn.addEventListener('click', function (e) {
      e.stopPropagation();
      isOpen = !isOpen;

      if (isOpen) {
        menu.classList.remove('invisible', 'opacity-0', 'scale-95');
        menu.classList.add('visible', 'opacity-100', 'scale-100');
      } else {
        menu.classList.remove('visible', 'opacity-100', 'scale-100');
        menu.classList.add('invisible', 'opacity-0', 'scale-95');
      }
    });

    // Click outside to close
    document.addEventListener('click', function (event) {
      if (!menu.contains(event.target) && !toggleBtn.contains(event.target)) {
        isOpen = false;
        menu.classList.remove('visible', 'opacity-100', 'scale-100');
        menu.classList.add('invisible', 'opacity-0', 'scale-95');
      }
    });
  });
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "text",
      "id": "header_Title",
      "label": "Title",
      "default": "Menu"
    },
    {
      "type": "link_list",
      "id": "another_menu",
      "label": "Header Menu",
      "default": "main-menu"
    }
  ]
}
{% endschema %}
